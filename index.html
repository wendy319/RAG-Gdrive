<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAGE - Smart Assistant For Global Enterprise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .chat-container {
            height: calc(100vh - 160px);
        }

        .message-bubble {
            max-width: 80%;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: #94a3b8;
            display: inline-block;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .action-btn {
            transition: all 0.2s;
            color: #94a3b8;
        }
        .action-btn:hover {
            color: #4f46e5;
        }
        .action-btn.active-like { color: #10b981; }
        .action-btn.active-dislike { color: #ef4444; }
    </style>
</head>
<body class="bg-slate-50 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center sticky top-0 z-10 shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white shadow-md">
                <i class="fas fa-brain text-xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-slate-800 leading-none">SAGE</h1>
                <!-- <p class="text-xs text-slate-500 mt-1 uppercase tracking-wider font-medium">Enterprise Assistant</p> -->
            </div>
        </div>
        <div class="flex items-center gap-4 text-slate-400">
            <button title="Bersihkan Chat" onclick="clearChat()" class="hover:text-red-500 transition-colors p-2 hover:bg-red-50 rounded-full">
                <i class="fas fa-trash-alt"></i>
            </button>
            <div class="h-6 w-px bg-slate-200"></div>
            <span class="flex items-center gap-2 text-sm font-medium text-emerald-500 bg-emerald-50 px-3 py-1 rounded-full border border-emerald-100">
                <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                Online
            </span>
        </div>
    </header>

    <!-- Chat Area -->
    <main id="chatWindow" class="chat-container overflow-y-auto px-4 py-8 md:px-20 space-y-8 flex-grow">
        <!-- Initial Welcome Message -->
        <div class="flex justify-start">
            <div class="message-bubble bg-white border border-slate-200 text-slate-700 px-5 py-4 rounded-2xl rounded-tl-none shadow-sm relative group">
                <p class="text-sm leading-relaxed">Halo! Saya <strong>SAGE</strong> (Smart Assistant For Global Enterprise). Saya siap membantu menjawab pertanyaan Anda berdasarkan dokumen perusahaan. Ada yang bisa saya bantu hari ini?</p>
                <div class="flex items-center gap-4 mt-3 pt-3 border-t border-slate-50 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="action-btn text-xs" onclick="copyText(this)" title="Salin Jawaban"><i class="far fa-copy"></i></button>
                    <button class="action-btn text-xs" onclick="handleFeedback(this, 'like')" title="Suka"><i class="far fa-thumbs-up"></i></button>
                    <button class="action-btn text-xs" onclick="handleFeedback(this, 'dislike')" title="Tidak Suka"><i class="far fa-thumbs-down"></i></button>
                </div>
                <span class="text-[10px] text-slate-300 absolute -bottom-5 left-0">SAGE Assistant</span>
            </div>
        </div>
    </main>

    <!-- Input Area -->
    <footer class="bg-white border-t border-slate-200 p-4 md:px-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <form id="chatForm" class="relative max-w-4xl mx-auto flex items-center gap-3">
            <div class="flex-grow relative">
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="Tanyakan sesuatu pada SAGE..." 
                    autocomplete="off"
                    class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 pr-14 focus:ring-2 focus:ring-indigo-500 focus:bg-white focus:border-indigo-300 outline-none text-slate-700 transition-all shadow-inner"
                >
                <button 
                    type="submit" 
                    id="sendBtn"
                    class="absolute right-2.5 top-2.5 bottom-2.5 w-10 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-all flex items-center justify-center disabled:opacity-50 shadow-sm"
                >
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </form>
        <p class="text-center text-[10px] text-slate-400 mt-3 tracking-wide">Enterprise Intelligence by SAGE v2.5</p>
    </footer>

    <script>
        const N8N_WEBHOOK_URL = "https://webhook-alpha-explore.digibox.ai/webhook/2177434d-57df-41ad-bbc7-a691c43b6b9c";
        
        const sessionId = localStorage.getItem('sage_session_id') || 'session_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('sage_session_id', sessionId);

        const chatWindow = document.getElementById('chatWindow');
        const chatForm = document.getElementById('chatForm');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        function addMessage(text, isUser = false) {
            const wrapper = document.createElement('div');
            wrapper.className = isUser ? 'flex justify-end' : 'flex justify-start';

            const bubble = document.createElement('div');
            bubble.className = isUser 
                ? 'message-bubble bg-indigo-600 text-white px-5 py-3.5 rounded-2xl rounded-tr-none shadow-md'
                : 'message-bubble bg-white border border-slate-200 text-slate-700 px-5 py-4 rounded-2xl rounded-tl-none shadow-sm relative group';

            let feedbackHtml = !isUser ? `
                <div class="flex items-center gap-4 mt-3 pt-3 border-t border-slate-50 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="action-btn text-xs" onclick="copyText(this)" title="Salin Jawaban"><i class="far fa-copy"></i></button>
                    <button class="action-btn text-xs" onclick="handleFeedback(this, 'like')" title="Suka"><i class="far fa-thumbs-up"></i></button>
                    <button class="action-btn text-xs" onclick="handleFeedback(this, 'dislike')" title="Tidak Suka"><i class="far fa-thumbs-down"></i></button>
                </div>
            ` : '';

            bubble.innerHTML = `
                <p class="text-sm leading-relaxed">${text}</p>
                ${feedbackHtml}
                <span class="text-[10px] ${isUser ? 'text-indigo-200 text-right block w-full mt-1' : 'text-slate-300 absolute -bottom-5 left-0'}">
                    ${isUser ? 'Anda' : 'SAGE Assistant'}
                </span>
            `;

            wrapper.appendChild(bubble);
            chatWindow.appendChild(wrapper);
            chatWindow.scrollTo({ top: chatWindow.scrollHeight, behavior: 'smooth' });
        }

        function handleFeedback(btn, type) {
            const parent = btn.parentElement;
            const likeBtn = parent.querySelector('button[title="Suka"]');
            const dislikeBtn = parent.querySelector('button[title="Tidak Suka"]');

            if (type === 'like') {
                likeBtn.classList.toggle('active-like');
                likeBtn.querySelector('i').classList.toggle('far');
                likeBtn.querySelector('i').classList.toggle('fas');
                dislikeBtn.classList.remove('active-dislike');
                dislikeBtn.querySelector('i').classList.replace('fas', 'far');
            } else {
                dislikeBtn.classList.toggle('active-dislike');
                dislikeBtn.querySelector('i').classList.toggle('far');
                dislikeBtn.querySelector('i').classList.toggle('fas');
                likeBtn.classList.remove('active-like');
                likeBtn.querySelector('i').classList.replace('fas', 'far');
            }
        }

        function copyText(btn) {
            const text = btn.closest('.message-bubble').querySelector('p').innerText;
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            const icon = btn.querySelector('i');
            icon.className = 'fas fa-check text-emerald-500';
            setTimeout(() => { icon.className = 'far fa-copy'; }, 2000);
        }

        function showTyping() {
            const id = 'typing-indicator';
            const wrapper = document.createElement('div');
            wrapper.id = id;
            wrapper.className = 'flex justify-start';
            wrapper.innerHTML = `
                <div class="message-bubble bg-slate-200 px-5 py-4 rounded-2xl rounded-tl-none flex items-center gap-1">
                    <div class="typing-indicator flex gap-1">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatWindow.appendChild(wrapper);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return id;
        }

        function removeTyping(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function clearChat() {
            if (confirm('Hapus seluruh riwayat percakapan?')) {
                chatWindow.innerHTML = '';
                addMessage('Halo! Saya <strong>SAGE</strong>. Saya siap membantu menjawab pertanyaan Anda berdasarkan dokumen perusahaan. Ada yang bisa saya bantu hari ini?', false);
            }
        }

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            userInput.value = '';
            
            userInput.disabled = true;
            sendBtn.disabled = true;

            const typingId = showTyping();

            try {
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chatInput: message,
                        sessionId: sessionId
                    })
                });

                if (!response.ok) throw new Error('Gagal terhubung ke server SAGE');

                const data = await response.json();
                removeTyping(typingId);
                const reply = data.output || data.text || "Maaf, saya tidak menerima respon yang valid dari sistem.";
                addMessage(reply, false);

            } catch (error) {
                removeTyping(typingId);
                addMessage(`Kesalahan: ${error.message}.`, false);
            } finally {
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus();
            }
        });
    </script>
</body>
</html>





